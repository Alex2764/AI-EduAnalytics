<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏ –∏ —Ç–µ—Å—Ç–æ–≤–µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .nav-tabs {
            display: flex;
            background-color: #34495e;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            margin-bottom: 0;
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            background-color: #34495e;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-tab:hover {
            background-color: #4a6741;
        }

        .nav-tab.active {
            background-color: #27ae60;
        }

        .content {
            background-color: white;
            padding: 30px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            align-items: end;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        input[type="text"], input[type="number"], input[type="date"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #27ae60;
        }

        .btn {
            background-color: #27ae60;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #229954;
        }

        .btn-danger {
            background-color: #e74c3c;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-secondary {
            background-color: #95a5a6;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background-color: #34495e;
            color: white;
            font-weight: bold;
        }

        .table tr:hover {
            background-color: #f8f9fa;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .bulk-section {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }

        .info-section {
            display: none;
            margin: 20px 0;
            padding: 15px;
            background-color: #e8f5e8;
            border-radius: 5px;
        }

        .single-form {
            display: none;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f0f8ff;
            border-radius: 10px;
        }

        .student-input-row {
            display: grid;
            grid-template-columns: 50px 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .student-number {
            text-align: center;
            font-weight: bold;
            color: #2c3e50;
        }

        .student-input-row input {
            margin-bottom: 0;
        }

        #studentInputsContainer {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background-color: #ffffff;
        }

        /* –ú–æ–¥–∞–ª–Ω–æ –ø—Ä–æ–∑–æ—Ä—á–µ –∑–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 20px;
            border-radius: 10px;
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #34495e;
        }

        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #e74c3c;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .results-table th, .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .results-table th {
            background-color: #34495e;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        .results-table tr:hover {
            background-color: #f8f9fa;
        }

        .result-input {
            width: 80px;
            padding: 5px;
            border: 1px solid #bdc3c7;
            border-radius: 3px;
            text-align: center;
        }

        .result-input:focus {
            outline: none;
            border-color: #27ae60;
        }

        .grade-display {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
            text-align: center;
            min-width: 40px;
            display: inline-block;
        }

        .grade-excellent { background-color: #d4edda; color: #155724; }
        .grade-very-good { background-color: #d1ecf1; color: #0c5460; }
        .grade-good { background-color: #fff3cd; color: #856404; }
        .grade-satisfactory { background-color: #f8d7da; color: #721c24; }
        .grade-poor { background-color: #f5c6cb; color: #721c24; }

        .bulk-actions {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .bulk-actions input {
            width: 100px;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .nav-tabs {
                flex-direction: column;
            }

            .student-input-row {
                grid-template-columns: 40px 1fr;
                gap: 5px;
            }

            .student-input-row input {
                grid-column: span 1;
                margin-bottom: 5px;
            }

            .modal-content {
                margin: 1% auto;
                width: 98%;
                padding: 10px;
            }

            .results-table {
                font-size: 12px;
            }

            .results-table th, .results-table td {
                padding: 8px 4px;
            }

            .result-input {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö –°–∏—Å—Ç–µ–º–∞ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏ –∏ —Ç–µ—Å—Ç–æ–≤–µ</h1>
            <p>–ï–ª–µ–∫—Ç—Ä–æ–Ω–µ–Ω –¥–Ω–µ–≤–Ω–∏–∫ –∑–∞ –∞–Ω–∞–ª–∏–∑ –Ω–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—Ç–∞</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('classes')">üè´ –ö–ª–∞—Å–æ–≤–µ</button>
            <button class="nav-tab" onclick="showSection('tests')">üìù –¢–µ—Å—Ç–æ–≤–µ</button>
            <button class="nav-tab" onclick="showSection('analytics')">üìä –ê–Ω–∞–ª–∏–∑–∏</button>
        </div>

        <div class="content">
            <!-- –°–µ–∫—Ü–∏—è –ö–ª–∞—Å–æ–≤–µ -->
            <div id="classes" class="section active">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫–ª–∞—Å–æ–≤–µ</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="newClassName">–ò–º–µ –Ω–∞ –∫–ª–∞—Å:</label>
                        <select id="newClassName">
                            <option value="">–ò–∑–±–µ—Ä–µ—Ç–µ –∫–ª–∞—Å</option>
                            <option value="5–ê">5–ê</option>
                            <option value="5–ë">5–ë</option>
                            <option value="6–ê">6–ê</option>
                            <option value="6–ë">6–ë</option>
                            <option value="7–ê">7–ê</option>
                            <option value="7–ë">7–ë</option>
                            <option value="8–ê">8–ê</option>
                            <option value="8–ë">8–ë</option>
                            <option value="9–ê">9–ê</option>
                            <option value="9–ë">9–ë</option>
                            <option value="10–ê">10–ê</option>
                            <option value="10–ë">10–ë</option>
                            <option value="11–ê">11–ê</option>
                            <option value="11–ë">11–ë</option>
                            <option value="12–ê">12–ê</option>
                            <option value="12–ë">12–ë</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="schoolYear">–£—á–µ–±–Ω–∞ –≥–æ–¥–∏–Ω–∞:</label>
                        <input type="text" id="schoolYear" placeholder="2024/2025" value="2024/2025">
                    </div>
                    <div class="form-group">
                        <button class="btn" onclick="createClass()">‚ûï –°—ä–∑–¥–∞–π –∫–ª–∞—Å</button>
                    </div>
                </div>

                <table class="table" id="classesTable">
                    <thead>
                        <tr>
                            <th>‚Ññ</th>
                            <th>–ö–ª–∞—Å</th>
                            <th>–£—á–µ–±–Ω–∞ –≥–æ–¥–∏–Ω–∞</th>
                            <th>–ë—Ä–æ–π —É—á–µ–Ω–∏—Ü–∏</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="classesBody">
                    </tbody>
                </table>

                <!-- –°–µ–∫—Ü–∏—è –∑–∞ –≥—Ä—É–ø–æ–≤–æ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏ -->
                <div id="bulkStudentSection" class="bulk-section">
                    <h3 id="bulkStudentTitle">–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏</h3>
                    <p style="color: #7f8c8d; margin-bottom: 20px;">–í—ä–≤–µ–¥–µ—Ç–µ –¥–∞–Ω–Ω–∏—Ç–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏—Ç–µ. –ú–æ–∂–µ—Ç–µ –¥–∞ –¥–æ–±–∞–≤—è—Ç–µ –Ω–æ–≤–∏ —Ä–µ–¥–æ–≤–µ —Å –±—É—Ç–æ–Ω–∞ "–î–æ–±–∞–≤–∏ —Ä–µ–¥".</p>
                    
                    <div class="form-row" style="margin-bottom: 15px;">
                        <div class="form-group">
                            <label>–ë—Ä–æ–π —É—á–µ–Ω–∏—Ü–∏:</label>
                            <input type="number" id="studentCount" min="1" max="35" value="25" onchange="generateStudentInputs()">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn" onclick="generateStudentInputs()">üîÑ –ì–µ–Ω–µ—Ä–∏—Ä–∞–π –ø–æ–ª–µ—Ç–∞</button>
                        </div>
                    </div>

                    <div id="studentInputsContainer">
                        <!-- –¢—É–∫ —â–µ —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞—Ç input –ø–æ–ª–µ—Ç–∞—Ç–∞ -->
                    </div>

                    <div class="form-row" style="margin-top: 20px;">
                        <div class="form-group">
                            <button class="btn" onclick="saveBulkStudents()">üíæ –ó–∞–ø–∞–∑–∏ —É—á–µ–Ω–∏—Ü–∏—Ç–µ</button>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="cancelBulkStudents()">‚ùå –û—Ç–∫–∞–∂–∏</button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- –°–µ–∫—Ü–∏—è –¢–µ—Å—Ç–æ–≤–µ -->
            <div id="tests" class="section">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–µ</h2>

                <div class="form-row">
                    <div class="form-group">
                        <label for="testName">–ò–º–µ –Ω–∞ —Ç–µ—Å—Ç:</label>
                        <input type="text" id="testName" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ —Ç–µ—Å—Ç–∞">
                    </div>
                    <div class="form-group">
                        <label for="testClass">–ö–ª–∞—Å:</label>
                        <select id="testClass">
                            <option value="">–ò–∑–±–µ—Ä–µ—Ç–µ –∫–ª–∞—Å</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="testType">–¢–∏–ø —Ç–µ—Å—Ç:</label>
                        <select id="testType">
                            <option value="">–ò–∑–±–µ—Ä–µ—Ç–µ —Ç–∏–ø</option>
                            <option value="–ù–æ—Ä–º–∞–ª–µ–Ω —Ç–µ—Å—Ç">–ù–æ—Ä–º–∞–ª–µ–Ω —Ç–µ—Å—Ç</option>
                            <option value="–ö–ª–∞—Å–Ω–∞ —Ä–∞–±–æ—Ç–∞">–ö–ª–∞—Å–Ω–∞ —Ä–∞–±–æ—Ç–∞</option>
                            <option value="–í—Ö–æ–¥–Ω–æ –Ω–∏–≤–æ">–í—Ö–æ–¥–Ω–æ –Ω–∏–≤–æ</option>
                            <option value="–ò–∑—Ö–æ–¥–Ω–æ –Ω–∏–≤–æ">–ò–∑—Ö–æ–¥–Ω–æ –Ω–∏–≤–æ</option>
                            <option value="–ú–µ–∂–¥–∏–Ω–Ω–æ –Ω–∏–≤–æ">–ú–µ–∂–¥–∏–Ω–Ω–æ –Ω–∏–≤–æ</option>
                            <option value="–¢–µ–∫—É—â–∞ –æ—Ü–µ–Ω–∫–∞">–¢–µ–∫—É—â–∞ –æ—Ü–µ–Ω–∫–∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="testDate">–î–∞—Ç–∞:</label>
                        <input type="date" id="testDate">
                    </div>
                    <div class="form-group">
                        <label for="maxPoints">–ú–∞–∫—Å–∏–º–∞–ª–Ω–∏ —Ç–æ—á–∫–∏:</label>
                        <input type="number" id="maxPoints" placeholder="–ú–∞–∫—Å. —Ç–æ—á–∫–∏" min="1">
                    </div>
                </div>

                <div class="form-group">
                    <button class="btn" onclick="createTest()">üÜï –°—ä–∑–¥–∞–π —Ç–µ—Å—Ç</button>
                </div>

                <table class="table" id="testsTable">
                    <thead>
                        <tr>
                            <th>‚Ññ</th>
                            <th>–ò–º–µ –Ω–∞ —Ç–µ—Å—Ç</th>
                            <th>–ö–ª–∞—Å</th>
                            <th>–¢–∏–ø</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ú–∞–∫—Å. —Ç–æ—á–∫–∏</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="testsBody">
                    </tbody>
                </table>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –ê–Ω–∞–ª–∏–∑–∏ -->
            <div id="analytics" class="section">
                <h2>–ê–Ω–∞–ª–∏–∑–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h2>

                <div style="background-color: #f8f9fa; padding: 40px; border-radius: 10px; text-align: center; margin-top: 20px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">ü§ñ</div>
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">–©–µ –∏–º–∞ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è —Å AI</h3>
                    <p style="font-size: 18px; color: #7f8c8d; margin-bottom: 10px;">–û—á–∞–∫–≤–∞–π—Ç–µ —Å–∫–æ—Ä–æ</p>
                    <div style="background-color: #e8f5e8; padding: 20px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #27ae60;">
                        <p style="margin: 0; color: #155724; font-weight: bold;">üöÄ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:</p>
                        <ul style="text-align: left; margin: 10px 0; color: #155724;">
                            <li>–ü—Ä–∏–∫–∞—á–≤–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–µ—Ç–µ –∏ –∞–Ω–∞–ª–∏–∑ –æ—Ç AI</li>
                            <li>–î–∞–≤–∞–Ω–µ –Ω–∞ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –ø—Ä–æ–ø—É—Å–∫–∏—Ç–µ –æ—Ç —É—á–µ–Ω–∏—Ü–∏—Ç–µ</li>
                            <li>–ú–æ—Ç–∏–≤–∞—Ü–∏—è</li>
                            <li>–ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–µ–Ω –∞–Ω–∞–ª–∏–∑ –Ω–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—Ç–∞</li>
                            <li>AI –ø—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –ø–æ–¥–æ–±—Ä—è–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ</li>
                            <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ç—á–µ—Ç–∏</li>
                            <li>–ü—Ä–µ–¥—Å–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Ä–∏—Å–∫–æ–≤–µ –≤ –æ–±—É—á–µ–Ω–∏–µ—Ç–æ</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="alerts"></div>

    <!-- –ú–æ–¥–∞–ª–Ω–æ –ø—Ä–æ–∑–æ—Ä—á–µ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏ -->
    <div id="studentsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="studentsModalTitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏</h3>
                <span class="close" onclick="closeStudentsModal()">&times;</span>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –∑–∞ –¥–æ–±–∞–≤—è–Ω–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —É—á–µ–Ω–∏–∫ -->
            <div style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h4 id="studentFormTitle">–î–æ–±–∞–≤–∏ –Ω–æ–≤ —É—á–µ–Ω–∏–∫</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="modalFirstName">–ò–º–µ:</label>
                        <input type="text" id="modalFirstName" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ">
                    </div>
                    <div class="form-group">
                        <label for="modalMiddleName">–ü—Ä–µ–∑–∏—Ä–µ:</label>
                        <input type="text" id="modalMiddleName" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ø—Ä–µ–∑–∏—Ä–µ">
                    </div>
                    <div class="form-group">
                        <label for="modalLastName">–§–∞–º–∏–ª–∏—è:</label>
                        <input type="text" id="modalLastName" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ —Ñ–∞–º–∏–ª–∏—è">
                    </div>
                    <div class="form-group">
                        <label for="modalStudentNumber">–ù–æ–º–µ—Ä –≤ –∫–ª–∞—Å:</label>
                        <input type="number" id="modalStudentNumber" placeholder="–ù–æ–º–µ—Ä" min="1">
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <button class="btn" onclick="saveStudent()" id="saveStudentBtn">‚ûï –î–æ–±–∞–≤–∏ —É—á–µ–Ω–∏–∫</button>
                    <button class="btn btn-secondary" onclick="cancelStudentEdit()" id="cancelStudentBtn" style="display: none;">‚ùå –û—Ç–∫–∞–∂–∏</button>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –∫–ª–∞—Å–∞ -->
            <div id="studentsModalInfo" style="background-color: #e8f5e8; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                <h3 id="studentsModalClassInfo">–ö–ª–∞—Å: </h3>
                <p id="studentsModalStats">–û–±—â–æ —É—á–µ–Ω–∏—Ü–∏: 0</p>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ —Å —É—á–µ–Ω–∏—Ü–∏—Ç–µ -->
            <table class="table" id="studentsModalTable">
                <thead>
                    <tr>
                        <th>‚Ññ</th>
                        <th>–ò–º–µ</th>
                        <th>–ü—Ä–µ–∑–∏—Ä–µ</th>
                        <th>–§–∞–º–∏–ª–∏—è</th>
                        <th>–ù–æ–º–µ—Ä –≤ –∫–ª–∞—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="studentsModalBody">
                </tbody>
            </table>

            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="closeStudentsModal()">‚ùå –ó–∞—Ç–≤–æ—Ä–∏</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–Ω–æ –ø—Ä–æ–∑–æ—Ä—á–µ –∑–∞ –∞–Ω–∞–ª–∏–∑ –Ω–∞ —Ç–µ—Å—Ç -->
    <div id="testAnalyticsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="testAnalyticsTitle">–ê–Ω–∞–ª–∏–∑ –Ω–∞ —Ç–µ—Å—Ç</h3>
                <span class="close" onclick="closeTestAnalyticsModal()">&times;</span>
            </div>
            
            <div id="testAnalyticsContent">
                <!-- –¢—É–∫ —â–µ —Å–µ –ø–æ–∫–∞–∑–≤–∞ –∞–Ω–∞–ª–∏–∑—ä—Ç –Ω–∞ —Ç–µ—Å—Ç–∞ -->
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="closeTestAnalyticsModal()">‚ùå –ó–∞—Ç–≤–æ—Ä–∏</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–Ω–æ –ø—Ä–æ–∑–æ—Ä—á–µ –∑–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">–í—ä–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏</h3>
                <span class="close" onclick="closeResultsModal()">&times;</span>
            </div>
            
            <div id="modalTestInfo">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Ç–µ—Å—Ç–∞ -->
            </div>

            <div class="bulk-actions">
                <label>–ë—ä—Ä–∑–æ –ø–æ–ø—ä–ª–≤–∞–Ω–µ:</label>
                <input type="number" id="bulkPoints" placeholder="–¢–æ—á–∫–∏" min="0" max="100">
                <button class="btn" onclick="fillBulkPoints()">–ü–æ–ø—ä–ª–Ω–∏ –≤—Å–∏—á–∫–∏</button>
                <button class="btn btn-secondary" onclick="clearAllResults()">–ò–∑—á–∏—Å—Ç–∏ –≤—Å–∏—á–∫–∏</button>
            </div>

            <table class="results-table" id="resultsTable">
                <thead>
                    <tr>
                        <th>‚Ññ</th>
                        <th>–ò–º–µ</th>
                        <th>–ü—Ä–µ–∑–∏—Ä–µ</th>
                        <th>–§–∞–º–∏–ª–∏—è</th>
                        <th>–¢–æ—á–∫–∏</th>
                        <th>–û—Ü–µ–Ω–∫–∞</th>
                        <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                    <!-- –¢—É–∫ —â–µ —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞—Ç —Ä–µ–¥–æ–≤–µ—Ç–µ –∑–∞ —É—á–µ–Ω–∏—Ü–∏—Ç–µ -->
                </tbody>
            </table>

            <div style="margin-top: 20px; text-align: center;">
                <button class="btn" onclick="saveResults()">üíæ –ó–∞–ø–∞–∑–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ</button>
                <button class="btn btn-secondary" onclick="closeResultsModal()">‚ùå –û—Ç–∫–∞–∂–∏</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª–Ω–∏ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏
        let students = JSON.parse(localStorage.getItem('students') || '[]');
        let tests = JSON.parse(localStorage.getItem('tests') || '[]');
        let results = JSON.parse(localStorage.getItem('results') || '[]');
        let classes = JSON.parse(localStorage.getItem('classes') || '[]');
        let currentEditingClass = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Å–µ –∑–∞—Ä–µ–∂–¥–∞...');
            displayClasses();
            updateClassFilters();
            displayTests();
            
            // –ó–∞–¥–∞–π –¥–Ω–µ—à–Ω–∞—Ç–∞ –¥–∞—Ç–∞ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
            const testDateInput = document.getElementById('testDate');
            if (testDateInput) {
                testDateInput.valueAsDate = new Date();
            }
            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –µ –∑–∞—Ä–µ–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!');
        });

        // –§—É–Ω–∫—Ü–∏–∏ –∑–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
        function showSection(sectionId) {
            // –°–∫—Ä–∏–π –≤—Å–∏—á–∫–∏ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            // –ü–æ–∫–∞–∂–∏ –∏–∑–±—Ä–∞–Ω–∞—Ç–∞ —Å–µ–∫—Ü–∏—è
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∑–∞ –∫–ª–∞—Å–æ–≤–µ
        function createClass() {
            const className = document.getElementById('newClassName').value;
            const schoolYear = document.getElementById('schoolYear').value.trim();

            if (!className || !schoolYear) {
                showAlert('–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!', 'error');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –∫–ª–∞—Å—ä—Ç –≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞
            if (classes.some(c => c.name === className && c.schoolYear === schoolYear)) {
                showAlert('–¢–æ–∑–∏ –∫–ª–∞—Å –≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∑–∞ —Ç–∞–∑–∏ —É—á–µ–±–Ω–∞ –≥–æ–¥–∏–Ω–∞!', 'error');
                return;
            }

            const classObj = {
                id: Date.now(),
                name: className,
                schoolYear: schoolYear,
                createdDate: new Date().toISOString()
            };

            classes.push(classObj);
            localStorage.setItem('classes', JSON.stringify(classes));

            // –ò–∑—á–∏—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞
            document.getElementById('newClassName').value = '';
            document.getElementById('schoolYear').value = '2024/2025';

            displayClasses();
            updateClassFilters();
            showAlert('–ö–ª–∞—Å—ä—Ç –µ —Å—ä–∑–¥–∞–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
        }

        function displayClasses() {
            const tbody = document.getElementById('classesBody');
            if (!tbody) return;
            
            // –°–æ—Ä—Ç–∏—Ä–∞–π –ø–æ –∏–º–µ –Ω–∞ –∫–ª–∞—Å–∞
            const sortedClasses = [...classes].sort((a, b) => a.name.localeCompare(b.name));

            tbody.innerHTML = sortedClasses.map((classObj, index) => {
                const studentCount = students.filter(s => s.class === classObj.name).length;
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${classObj.name}</strong></td>
                        <td>${classObj.schoolYear}</td>
                        <td>${studentCount}</td>
                        <td>
                            <button class="btn" onclick="editClassStudents('${classObj.name}')">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏</button>
                            <button class="btn btn-danger" onclick="deleteClass(${classObj.id})">üóëÔ∏è –ò–∑—Ç—Ä–∏–π</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function deleteClass(classId) {
            const classObj = classes.find(c => c.id === classId);
            if (!classObj) return;

            const studentCount = students.filter(s => s.class === classObj.name).length;
            
            if (studentCount > 0) {
                if (!confirm(`–í –∫–ª–∞—Å–∞ ${classObj.name} –∏–º–∞ ${studentCount} —É—á–µ–Ω–∏—Ü–∏. –°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ –∫–ª–∞—Å–∞? –¢–æ–≤–∞ —â–µ –∏–∑—Ç—Ä–∏–µ –∏ –≤—Å–∏—á–∫–∏ —É—á–µ–Ω–∏—Ü–∏ –∏ —Ç–µ—Ö–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏!`)) {
                    return;
                }
                
                // –ò–∑—Ç—Ä–∏–π —É—á–µ–Ω–∏—Ü–∏—Ç–µ –∏ —Ç–µ—Ö–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
                const studentIds = students.filter(s => s.class === classObj.name).map(s => s.id);
                students = students.filter(s => s.class !== classObj.name);
                results = results.filter(r => !studentIds.includes(r.studentId));
                
                // –ò–∑—Ç—Ä–∏–π —Ç–µ—Å—Ç–æ–≤–µ—Ç–µ –∑–∞ —Ç–æ–∑–∏ –∫–ª–∞—Å
                const testIds = tests.filter(t => t.class === classObj.name).map(t => t.id);
                tests = tests.filter(t => t.class !== classObj.name);
                results = results.filter(r => !testIds.includes(r.testId));
                
                localStorage.setItem('students', JSON.stringify(students));
                localStorage.setItem('tests', JSON.stringify(tests));
                localStorage.setItem('results', JSON.stringify(results));
            } else {
                if (!confirm(`–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ –∫–ª–∞—Å–∞ ${classObj.name}?`)) {
                    return;
                }
            }

            classes = classes.filter(c => c.id !== classId);
            localStorage.setItem('classes', JSON.stringify(classes));

            displayClasses();
            updateClassFilters();
            showAlert('–ö–ª–∞—Å—ä—Ç –µ –∏–∑—Ç—Ä–∏—Ç —É—Å–ø–µ—à–Ω–æ!', 'success');
        }

        function editClassStudents(className) {
            currentEditingClass = className;
            
            // –ó–∞–¥–∞–π –∑–∞–≥–ª–∞–≤–∏–µ—Ç–æ –Ω–∞ –º–æ–¥–∞–ª–Ω–æ—Ç–æ –ø—Ä–æ–∑–æ—Ä—á–µ
            document.getElementById('studentsModalTitle').textContent = `–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏ - –ö–ª–∞—Å ${className}`;
            document.getElementById('studentsModalClassInfo').textContent = `–ö–ª–∞—Å: ${className}`;
            
            // –û–±–Ω–æ–≤–∏ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ —Å —É—á–µ–Ω–∏—Ü–∏—Ç–µ
            displayStudentsModal(className);
            
            // –ü–æ–∫–∞–∂–∏ –º–æ–¥–∞–ª–Ω–æ—Ç–æ –ø—Ä–æ–∑–æ—Ä—á–µ
            document.getElementById('studentsModal').style.display = 'block';
        }

        function generateStudentInputs() {
            const studentCount = parseInt(document.getElementById('studentCount').value) || 25;
            const container = document.getElementById('studentInputsContainer');
            
            if (!container) return;

            // –ó–∞–ø–∞–∑–∏ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—Ç–µ –¥–∞–Ω–Ω–∏
            const existingData = {};
            for (let i = 1; i <= 50; i++) { // –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ 50 –∑–∞ –≤—Å–µ–∫–∏ —Å–ª—É—á–∞–π
                const firstName = document.getElementById(`firstName_${i}`);
                const middleName = document.getElementById(`middleName_${i}`);
                const lastName = document.getElementById(`lastName_${i}`);
                
                if (firstName && middleName && lastName) {
                    existingData[i] = {
                        firstName: firstName.value,
                        middleName: middleName.value,
                        lastName: lastName.value
                    };
                }
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–π –Ω–æ–≤–∏—Ç–µ input –ø–æ–ª–µ—Ç–∞
            let html = '';
            for (let i = 1; i <= studentCount; i++) {
                const existing = existingData[i] || { firstName: '', middleName: '', lastName: '' };
                html += `
                    <div class="student-input-row">
                        <div class="student-number">${i}.</div>
                        <input type="text" id="firstName_${i}" placeholder="–ò–º–µ" value="${existing.firstName}">
                        <input type="text" id="middleName_${i}" placeholder="–ü—Ä–µ–∑–∏—Ä–µ" value="${existing.middleName}">
                        <input type="text" id="lastName_${i}" placeholder="–§–∞–º–∏–ª–∏—è" value="${existing.lastName}">
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function saveBulkStudents() {
            if (!currentEditingClass) return;

            const studentCount = parseInt(document.getElementById('studentCount').value) || 25;
            
            // –ò–∑—Ç—Ä–∏–π —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—Ç–µ —É—á–µ–Ω–∏—Ü–∏ –æ—Ç —Ç–æ–∑–∏ –∫–ª–∞—Å
            students = students.filter(s => s.class !== currentEditingClass);

            const newStudents = [];
            const errors = [];

            for (let i = 1; i <= studentCount; i++) {
                const firstNameInput = document.getElementById(`firstName_${i}`);
                const middleNameInput = document.getElementById(`middleName_${i}`);
                const lastNameInput = document.getElementById(`lastName_${i}`);
                
                if (!firstNameInput || !middleNameInput || !lastNameInput) continue;

                const firstName = firstNameInput.value.trim();
                const middleName = middleNameInput.value.trim();
                const lastName = lastNameInput.value.trim();

                // –ê–∫–æ –≤—Å–∏—á–∫–∏—Ç–µ –ø–æ–ª–µ—Ç–∞ —Å–∞ –ø—Ä–∞–∑–Ω–∏, –ø—Ä–µ—Å–∫–∞—á–∞–π
                if (!firstName && !middleName && !lastName) continue;

                // –ê–∫–æ –Ω—è–∫–æ–µ –ø–æ–ª–µ –µ –ø—Ä–∞–∑–Ω–æ, –∞ –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ –Ω–µ —Å–∞
                if (!firstName || !middleName || !lastName) {
                    errors.push(`–†–µ–¥ ${i}: –ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞ –∏–ª–∏ –æ—Å—Ç–∞–≤–µ—Ç–µ —Ä–µ–¥–∞ –ø—Ä–∞–∑–µ–Ω`);
                    continue;
                }

                const student = {
                    id: Date.now() + i,
                    firstName,
                    middleName,
                    lastName,
                    class: currentEditingClass,
                    number: i
                };

                newStudents.push(student);
            }

            if (errors.length > 0) {
                showAlert(`–ì—Ä–µ—à–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞—Ç–∞:\n${errors.join('\n')}`, 'error');
                return;
            }

            if (newStudents.length === 0) {
                showAlert('–ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ –ø–æ–Ω–µ –µ–¥–∏–Ω —É—á–µ–Ω–∏–∫!', 'error');
                return;
            }

            students.push(...newStudents);
            localStorage.setItem('students', JSON.stringify(students));

            document.getElementById('bulkStudentSection').style.display = 'none';
            currentEditingClass = null;
            
            displayClasses();
            updateClassFilters();
            
            showAlert(`–£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–µ–Ω–∏ ${newStudents.length} —É—á–µ–Ω–∏—Ü–∏ –≤ –∫–ª–∞—Å ${currentEditingClass}!`, 'success');
        }

        function cancelBulkStudents() {
            document.getElementById('bulkStudentSection').style.display = 'none';
            currentEditingClass = null;
            
            // –ò–∑—á–∏—Å—Ç–∏ container-–∞
            const container = document.getElementById('studentInputsContainer');
            if (container) {
                container.innerHTML = '';
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∑–∞ —É—á–µ–Ω–∏—Ü–∏


        // –ì–ª–æ–±–∞–ª–Ω–∞ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∞ –∑–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —É—á–µ–Ω–∏–∫
        let currentEditingStudent = null;

        function displayStudentsModal(className) {
            const tbody = document.getElementById('studentsModalBody');
            const studentsModalStats = document.getElementById('studentsModalStats');
            
            if (!tbody || !studentsModalStats) return;
            
            const classStudents = students.filter(s => s.class === className).sort((a, b) => a.number - b.number);
            
            // –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏—Ç–µ
            studentsModalStats.textContent = `–û–±—â–æ —É—á–µ–Ω–∏—Ü–∏: ${classStudents.length}`;
            
            if (classStudents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">–ù—è–º–∞ —É—á–µ–Ω–∏—Ü–∏ –≤ —Ç–æ–∑–∏ –∫–ª–∞—Å</td></tr>';
                return;
            }

            tbody.innerHTML = classStudents.map((student, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${student.firstName}</td>
                    <td>${student.middleName}</td>
                    <td>${student.lastName}</td>
                    <td>${student.number}</td>
                    <td>
                        <button class="btn" onclick="editStudent(${student.id})" style="margin-right: 5px;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
                        <button class="btn btn-danger" onclick="deleteStudent(${student.id})">üóëÔ∏è –ò–∑—Ç—Ä–∏–π</button>
                    </td>
                </tr>
            `).join('');
        }

        function closeStudentsModal() {
            document.getElementById('studentsModal').style.display = 'none';
            currentEditingClass = null;
            currentEditingStudent = null;
            clearStudentForm();
        }

        function clearStudentForm() {
            document.getElementById('modalFirstName').value = '';
            document.getElementById('modalMiddleName').value = '';
            document.getElementById('modalLastName').value = '';
            document.getElementById('modalStudentNumber').value = '';
            document.getElementById('studentFormTitle').textContent = '–î–æ–±–∞–≤–∏ –Ω–æ–≤ —É—á–µ–Ω–∏–∫';
            document.getElementById('saveStudentBtn').textContent = '‚ûï –î–æ–±–∞–≤–∏ —É—á–µ–Ω–∏–∫';
            document.getElementById('cancelStudentBtn').style.display = 'none';
            currentEditingStudent = null;
        }

        function editStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;

            currentEditingStudent = student;
            
            // –ü–æ–ø—ä–ª–Ω–∏ —Ñ–æ—Ä–º–∞—Ç–∞ —Å –¥–∞–Ω–Ω–∏—Ç–µ –Ω–∞ —É—á–µ–Ω–∏–∫–∞
            document.getElementById('modalFirstName').value = student.firstName;
            document.getElementById('modalMiddleName').value = student.middleName;
            document.getElementById('modalLastName').value = student.lastName;
            document.getElementById('modalStudentNumber').value = student.number;
            
            // –ü—Ä–æ–º–µ–Ω–∏ –∑–∞–≥–ª–∞–≤–∏–µ—Ç–æ –∏ –±—É—Ç–æ–Ω–∏—Ç–µ
            document.getElementById('studentFormTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π —É—á–µ–Ω–∏–∫';
            document.getElementById('saveStudentBtn').textContent = 'üíæ –ó–∞–ø–∞–∑–∏ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ';
            document.getElementById('cancelStudentBtn').style.display = 'inline-block';
        }

        function cancelStudentEdit() {
            clearStudentForm();
        }

        function saveStudent() {
            if (!currentEditingClass) {
                showAlert('–ú–æ–ª—è –∏–∑–±–µ—Ä–µ—Ç–µ –∫–ª–∞—Å!', 'error');
                return;
            }

            const firstName = document.getElementById('modalFirstName').value.trim();
            const middleName = document.getElementById('modalMiddleName').value.trim();
            const lastName = document.getElementById('modalLastName').value.trim();
            const studentNumber = parseInt(document.getElementById('modalStudentNumber').value);

            if (!firstName || !middleName || !lastName || !studentNumber) {
                showAlert('–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!', 'error');
                return;
            }

            if (currentEditingStudent) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â —É—á–µ–Ω–∏–∫
                const studentIndex = students.findIndex(s => s.id === currentEditingStudent.id);
                if (studentIndex !== -1) {
                    students[studentIndex].firstName = firstName;
                    students[studentIndex].middleName = middleName;
                    students[studentIndex].lastName = lastName;
                    students[studentIndex].number = studentNumber;
                }
                showAlert('–£—á–µ–Ω–∏–∫—ä—Ç –µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
            } else {
                // –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤ —É—á–µ–Ω–∏–∫
                // –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –Ω–æ–º–µ—Ä—ä—Ç –≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –≤ –∫–ª–∞—Å–∞
                const existingStudent = students.find(s => s.class === currentEditingClass && s.number === studentNumber);
                if (existingStudent) {
                    showAlert('–£—á–µ–Ω–∏–∫ —Å —Ç–æ–∑–∏ –Ω–æ–º–µ—Ä –≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –≤ –∫–ª–∞—Å–∞!', 'error');
                    return;
                }

                const student = {
                    id: Date.now(),
                    firstName,
                    middleName,
                    lastName,
                    class: currentEditingClass,
                    number: studentNumber
                };

                students.push(student);
                showAlert('–£—á–µ–Ω–∏–∫—ä—Ç –µ –¥–æ–±–∞–≤–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
            }

            localStorage.setItem('students', JSON.stringify(students));
            
            // –û–±–Ω–æ–≤–∏ —Ç–∞–±–ª–∏—Ü–∏—Ç–µ
            displayStudentsModal(currentEditingClass);
            displayClasses();
            clearStudentForm();
        }

        function deleteStudent(id) {
            if (confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–æ–∑–∏ —É—á–µ–Ω–∏–∫?')) {
                const student = students.find(s => s.id === id);
                students = students.filter(s => s.id !== id);
                // –ò–∑—Ç—Ä–∏–π –∏ —Å–≤—ä—Ä–∑–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
                results = results.filter(r => r.studentId !== id);
                localStorage.setItem('students', JSON.stringify(students));
                localStorage.setItem('results', JSON.stringify(results));
                
                // –û–±–Ω–æ–≤–∏ —Ç–∞–±–ª–∏—Ü–∏—Ç–µ
                displayClasses();
                if (currentEditingClass && student) {
                    displayStudentsModal(currentEditingClass);
                }
                updateClassFilters();
                showAlert('–£—á–µ–Ω–∏–∫—ä—Ç –µ –∏–∑—Ç—Ä–∏—Ç —É—Å–ø–µ—à–Ω–æ!', 'success');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∑–∞ —Ç–µ—Å—Ç–æ–≤–µ
        function createTest() {
            const testName = document.getElementById('testName').value.trim();
            const testClass = document.getElementById('testClass').value;
            const testType = document.getElementById('testType').value;
            const testDate = document.getElementById('testDate').value;
            const maxPoints = parseInt(document.getElementById('maxPoints').value);

            if (!testName || !testClass || !testType || !testDate || !maxPoints) {
                showAlert('–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!', 'error');
                return;
            }

            const test = {
                id: Date.now(),
                name: testName,
                class: testClass,
                type: testType,
                date: testDate,
                maxPoints: maxPoints
            };

            tests.push(test);
            localStorage.setItem('tests', JSON.stringify(tests));

            // –ò–∑—á–∏—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞
            document.getElementById('testName').value = '';
            document.getElementById('testClass').value = '';
            document.getElementById('testType').value = '';
            document.getElementById('testDate').valueAsDate = new Date();
            document.getElementById('maxPoints').value = '';

            displayTests();
            showAlert('–¢–µ—Å—Ç—ä—Ç –µ —Å—ä–∑–¥–∞–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
        }

        function displayTests() {
            const tbody = document.getElementById('testsBody');
            if (!tbody) return;
            
            // –°–æ—Ä—Ç–∏—Ä–∞–π –ø–æ –¥–∞—Ç–∞ (–Ω–∞–π-–Ω–æ–≤–∏—Ç–µ –ø—ä—Ä–≤–æ)
            const sortedTests = [...tests].sort((a, b) => new Date(b.date) - new Date(a.date));

            tbody.innerHTML = sortedTests.map((test, index) => {
                // –ù–∞–º–µ—Ä–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –∑–∞ —Ç–æ–∑–∏ —Ç–µ—Å—Ç
                const testResults = results.filter(r => r.testId === test.id);
                const studentsInClass = students.filter(s => s.class === test.class).length;
                const resultsCount = testResults.length;
                
                // –ò–∑—á–∏—Å–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                let avgPoints = 0;
                let avgGrade = 0;
                let avgPercentage = 0;
                
                if (resultsCount > 0) {
                    avgPoints = (testResults.reduce((sum, r) => sum + r.points, 0) / resultsCount).toFixed(1);
                    avgPercentage = (testResults.reduce((sum, r) => sum + r.percentage, 0) / resultsCount).toFixed(1);
                    
                    // –ò–∑—á–∏—Å–ª–∏ —Å—Ä–µ–¥–Ω–∞—Ç–∞ –æ—Ü–µ–Ω–∫–∞ (–ø–æ–¥–¥—ä—Ä–∂–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∏ –æ—Ü–µ–Ω–∫–∏)
                    const gradeValues = testResults.map(r => parseFloat(r.grade) || 0);
                    avgGrade = (gradeValues.reduce((sum, g) => sum + g, 0) / resultsCount).toFixed(2);
                }

                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${test.name}</td>
                        <td>${test.class}</td>
                        <td>${test.type}</td>
                        <td>${formatDate(test.date)}</td>
                        <td>${test.maxPoints}</td>
                        <td>
                            <div style="margin-bottom: 5px;">
                                <button class="btn" onclick="openResultsModal(${test.id})">
                                    üìù ${resultsCount > 0 ? '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π —Ä–µ–∑—É–ª—Ç–∞—Ç–∏' : '–í—ä–≤–µ–¥–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏'}
                                </button>
                                ${resultsCount > 0 ? `
                                    <button class="btn" onclick="showTestAnalytics(${test.id})" style="margin-left: 5px; background-color: #9b59b6;">
                                        üìä –ê–Ω–∞–ª–∏–∑
                                    </button>
                                ` : ''}
                            </div>
                            ${resultsCount > 0 ? `
                                <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                    <strong>–†–µ–∑—É–ª—Ç–∞—Ç–∏:</strong> ${resultsCount}/${studentsInClass} —É—á–µ–Ω–∏—Ü–∏<br>
                                    <strong>–°—Ä–µ–¥–Ω–æ:</strong> ${avgPoints}—Ç/${test.maxPoints}—Ç (${avgPercentage}%)<br>
                                    <strong>–°—Ä–µ–¥–Ω–∞ –æ—Ü–µ–Ω–∫–∞:</strong> ${avgGrade}
                                </div>
                            ` : ''}
                            <div style="margin-top: 5px;">
                                <button class="btn btn-danger" onclick="deleteTest(${test.id})">üóëÔ∏è –ò–∑—Ç—Ä–∏–π</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function deleteTest(id) {
            if (confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–æ–∑–∏ —Ç–µ—Å—Ç?')) {
                tests = tests.filter(t => t.id !== id);
                // –ò–∑—Ç—Ä–∏–π –∏ —Å–≤—ä—Ä–∑–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
                results = results.filter(r => r.testId !== id);
                localStorage.setItem('tests', JSON.stringify(tests));
                localStorage.setItem('results', JSON.stringify(results));
                displayTests();
                showAlert('–¢–µ—Å—Ç—ä—Ç –µ –∏–∑—Ç—Ä–∏—Ç —É—Å–ø–µ—à–Ω–æ!', 'success');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞ –∞–Ω–∞–ª–∏–∑–∏
        function generateAnalytics() {
            const analyticsResults = document.getElementById('analyticsResults');
            const selectedClass = document.getElementById('analyticsClass').value;
            
            if (!selectedClass) {
                analyticsResults.innerHTML = '<p>–ú–æ–ª—è –∏–∑–±–µ—Ä–µ—Ç–µ –∫–ª–∞—Å –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ –∞–Ω–∞–ª–∏–∑–∏—Ç–µ.</p>';
                return;
            }
            
            // –ù–∞–º–µ—Ä–∏ —É—á–µ–Ω–∏—Ü–∏—Ç–µ –∏ —Ç–µ—Å—Ç–æ–≤–µ—Ç–µ –∑–∞ –∏–∑–±—Ä–∞–Ω–∏—è –∫–ª–∞—Å
            const classStudents = students.filter(s => s.class === selectedClass);
            const classTests = tests.filter(t => t.class === selectedClass);
            const classResults = results.filter(r => {
                const student = students.find(s => s.id === r.studentId);
                return student && student.class === selectedClass;
            });
            
            if (classStudents.length === 0) {
                analyticsResults.innerHTML = '<p>–ù—è–º–∞ —É—á–µ–Ω–∏—Ü–∏ –≤ —Ç–æ–∑–∏ –∫–ª–∞—Å.</p>';
                return;
            }
            
            if (classTests.length === 0) {
                analyticsResults.innerHTML = '<p>–ù—è–º–∞ —Ç–µ—Å—Ç–æ–≤–µ –∑–∞ —Ç–æ–∑–∏ –∫–ª–∞—Å.</p>';
                return;
            }
            
            // –ò–∑—á–∏—Å–ª–∏ –æ–±—â–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            const totalStudents = classStudents.length;
            const totalTests = classTests.length;
            const totalResults = classResults.length;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –æ—Ü–µ–Ω–∫–∏
            const gradeStats = {
                '6': classResults.filter(r => r.grade === '6').length,
                '5': classResults.filter(r => r.grade === '5').length,
                '4': classResults.filter(r => r.grade === '4').length,
                '3': classResults.filter(r => r.grade === '3').length,
                '2': classResults.filter(r => r.grade === '2').length
            };
            
            // –ò–∑—á–∏—Å–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–∏ –∑–∞ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ—Ç–æ
            const totalGrades = Object.values(gradeStats).reduce((sum, count) => sum + count, 0);
            const gradePercentages = {
                '6': totalGrades > 0 ? ((gradeStats['6'] / totalGrades) * 100).toFixed(1) : 0,
                '5': totalGrades > 0 ? ((gradeStats['5'] / totalGrades) * 100).toFixed(1) : 0,
                '4': totalGrades > 0 ? ((gradeStats['4'] / totalGrades) * 100).toFixed(1) : 0,
                '3': totalGrades > 0 ? ((gradeStats['3'] / totalGrades) * 100).toFixed(1) : 0,
                '2': totalGrades > 0 ? ((gradeStats['2'] / totalGrades) * 100).toFixed(1) : 0
            };
            
            // –°—Ä–µ–¥–Ω–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç
            const avgPercentage = totalResults > 0 ? 
                (classResults.reduce((sum, r) => sum + r.percentage, 0) / totalResults).toFixed(1) : 0;
            
            // –°—Ä–µ–¥–Ω–∞ –æ—Ü–µ–Ω–∫–∞ –∏–∑—á–∏—Å–ª–µ–Ω–∞ –æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∏—Ç–µ
            let avgGrade = '0';
            if (totalResults > 0) {
                const avgPercentageValue = parseFloat(avgPercentage);
                if (avgPercentageValue >= 92) {
                    avgGrade = '6.00';
                } else if (avgPercentageValue >= 76) {
                    avgGrade = '5.00';
                } else if (avgPercentageValue >= 60) {
                    avgGrade = '4.00';
                } else if (avgPercentageValue >= 40) {
                    avgGrade = '3.00';
                } else if (avgPercentageValue > 0) {
                    avgGrade = '2.00';
                } else {
                    avgGrade = '0.00';
                }
            }
            
            // –î–æ–±—Ä–∏ –æ—Ü–µ–Ω–∫–∏ (5-6)
            const goodGrades = gradeStats['5'] + gradeStats['6'];
            const goodGradesPercentage = totalGrades > 0 ? ((goodGrades / totalGrades) * 100).toFixed(1) : 0;
            
            
            analyticsResults.innerHTML = `
                <div style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üìä –û–±—â–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –∫–ª–∞—Å ${selectedClass}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background-color: white; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #2c3e50;">üë• –£—á–µ–Ω–∏—Ü–∏ –≤ –∫–ª–∞—Å–∞</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #27ae60; margin: 5px 0;">${totalStudents}</p>
                        </div>
                        <div style="background-color: white; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #2c3e50;">üìù –û–±—â–æ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #3498db; margin: 5px 0;">${totalResults}</p>
                        </div>
                        <div style="background-color: white; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #2c3e50;">üìä –°—Ä–µ–¥–µ–Ω —É—Å–ø–µ—Ö</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #9b59b6; margin: 5px 0;">${avgGrade}</p>
                        </div>
                        <div style="background-color: white; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #2c3e50;">üéØ –î–æ–±—Ä–∏ –æ—Ü–µ–Ω–∫–∏ (5-6)</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #e67e22; margin: 5px 0;">${goodGradesPercentage}%</p>
                        </div>
                    </div>
                </div>
                
                <div style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üéØ –†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ü–µ–Ω–∫–∏—Ç–µ</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px;">
                        <div style="background-color: #d4edda; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #155724;">–û—Ç–ª–∏—á–µ–Ω (6)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #155724; margin: 5px 0;">${gradeStats['6']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #155724; margin: 0;">${gradePercentages['6']}%</p>
                        </div>
                        <div style="background-color: #d1ecf1; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #0c5460;">–ú–Ω–æ–≥–æ –¥–æ–±—ä—Ä (5)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #0c5460; margin: 5px 0;">${gradeStats['5']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #0c5460; margin: 0;">${gradePercentages['5']}%</p>
                        </div>
                        <div style="background-color: #fff3cd; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #856404;">–î–æ–±—ä—Ä (4)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #856404; margin: 5px 0;">${gradeStats['4']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #856404; margin: 0;">${gradePercentages['4']}%</p>
                        </div>
                        <div style="background-color: #f8d7da; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #721c24;">–°—Ä–µ–¥–µ–Ω (3)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #721c24; margin: 5px 0;">${gradeStats['3']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #721c24; margin: 0;">${gradePercentages['3']}%</p>
                        </div>
                        <div style="background-color: #f5c6cb; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #721c24;">–°–ª–∞–± (2)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #721c24; margin: 5px 0;">${gradeStats['2']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #721c24; margin: 0;">${gradePercentages['2']}%</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // –ü–æ–º–æ—â–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏
        function updateClassFilters() {
            const existingClasses = [...new Set(students.map(s => s.class))].sort();
            const allClasses = [...new Set([...classes.map(c => c.name), ...existingClasses])].sort();
            
            // –û–±–Ω–æ–≤–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∑–∞ –ø—Ä–µ–≥–ª–µ–¥ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏
            const studentClassFilter = document.getElementById('studentClassFilter');
            if (studentClassFilter) {
                const currentValue = studentClassFilter.value;
                studentClassFilter.innerHTML = '<option value="">–ò–∑–±–µ—Ä–µ—Ç–µ –∫–ª–∞—Å</option>' +
                    allClasses.map(c => `<option value="${c}">${c}</option>`).join('');
                studentClassFilter.value = currentValue;
            }

            // –û–±–Ω–æ–≤–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏—Ç–µ –∑–∞ —Ç–µ—Å—Ç–æ–≤–µ
            const testClassSelect = document.getElementById('testClass');
            if (testClassSelect) {
                const testCurrentValue = testClassSelect.value;
                testClassSelect.innerHTML = '<option value="">–ò–∑–±–µ—Ä–µ—Ç–µ –∫–ª–∞—Å</option>' +
                    allClasses.map(c => `<option value="${c}">${c}</option>`).join('');
                testClassSelect.value = testCurrentValue;
            }

            // –û–±–Ω–æ–≤–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∑–∞ –∞–Ω–∞–ª–∏–∑–∏
            const analyticsClassSelect = document.getElementById('analyticsClass');
            if (analyticsClassSelect) {
                const analyticsCurrentValue = analyticsClassSelect.value;
                analyticsClassSelect.innerHTML = '<option value="">–ò–∑–±–µ—Ä–µ—Ç–µ –∫–ª–∞—Å</option>' +
                    allClasses.map(c => `<option value="${c}">${c}</option>`).join('');
                analyticsClassSelect.value = analyticsCurrentValue;
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('bg-BG');
        }

        function showAlert(message, type) {
            const alertsContainer = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'error' ? 'error' : 'success'}`;
            alert.textContent = message;
            
            alertsContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // –ì–ª–æ–±–∞–ª–Ω–∞ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∞ –∑–∞ —Ç–µ–∫—É—â–∏—è —Ç–µ—Å—Ç
        let currentTestId = null;

        // –§—É–Ω–∫—Ü–∏–∏ –∑–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
        function openResultsModal(testId) {
            currentTestId = testId;
            const test = tests.find(t => t.id === testId);
            if (!test) {
                showAlert('–¢–µ—Å—Ç—ä—Ç –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω!', 'error');
                return;
            }

            // –ü–æ–∫–∞–∂–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è—Ç–∞ –∑–∞ —Ç–µ—Å—Ç–∞
            document.getElementById('modalTitle').textContent = `–†–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞: ${test.name}`;
            document.getElementById('modalTestInfo').innerHTML = `
                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <strong>–¢–µ—Å—Ç:</strong> ${test.name}<br>
                    <strong>–ö–ª–∞—Å:</strong> ${test.class}<br>
                    <strong>–¢–∏–ø:</strong> ${test.type}<br>
                    <strong>–î–∞—Ç–∞:</strong> ${formatDate(test.date)}<br>
                    <strong>–ú–∞–∫—Å–∏–º–∞–ª–Ω–∏ —Ç–æ—á–∫–∏:</strong> ${test.maxPoints}
                </div>
            `;

            // –ù–∞–º–µ—Ä–∏ —É—á–µ–Ω–∏—Ü–∏—Ç–µ –æ—Ç —Ç–æ–∑–∏ –∫–ª–∞—Å
            const classStudents = students.filter(s => s.class === test.class).sort((a, b) => a.number - b.number);
            
            if (classStudents.length === 0) {
                showAlert('–ù—è–º–∞ —É—á–µ–Ω–∏—Ü–∏ –≤ —Ç–æ–∑–∏ –∫–ª–∞—Å!', 'error');
                return;
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–π —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ —Å —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
            generateResultsTable(classStudents, test);
            
            // –ü–æ–∫–∞–∂–∏ –º–æ–¥–∞–ª–Ω–æ—Ç–æ –ø—Ä–æ–∑–æ—Ä—á–µ
            document.getElementById('resultsModal').style.display = 'block';
        }

        function generateResultsTable(classStudents, test) {
            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            classStudents.forEach(student => {
                // –ù–∞–º–µ—Ä–∏ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—è —Ä–µ–∑—É–ª—Ç–∞—Ç –∑–∞ —Ç–æ–∑–∏ —É—á–µ–Ω–∏–∫ –∏ —Ç–µ—Å—Ç
                const existingResult = results.find(r => r.studentId === student.id && r.testId === test.id);
                const points = existingResult ? existingResult.points : '';
                const grade = existingResult ? existingResult.grade : '';
                const percentage = existingResult ? existingResult.percentage : '';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.number}</td>
                    <td>${student.firstName}</td>
                    <td>${student.middleName}</td>
                    <td>${student.lastName}</td>
                    <td>
                        <input type="number" 
                               class="result-input" 
                               id="points_${student.id}" 
                               value="${points}" 
                               min="0" 
                               max="${test.maxPoints}" 
                               onchange="calculateGrade(${student.id}, ${test.maxPoints})"
                               placeholder="0">
                    </td>
                    <td>
                        <span id="grade_${student.id}" class="grade-display">${grade}</span>
                    </td>
                    <td>
                        <span id="percentage_${student.id}">${percentage}%</span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function calculateGrade(studentId, maxPoints) {
            const pointsInput = document.getElementById(`points_${studentId}`);
            const gradeSpan = document.getElementById(`grade_${studentId}`);
            const percentageSpan = document.getElementById(`percentage_${studentId}`);
            
            if (!pointsInput || !gradeSpan || !percentageSpan) return;

            const points = parseFloat(pointsInput.value) || 0;
            const percentage = maxPoints > 0 ? (points / maxPoints) * 100 : 0;
            
            // –ò–∑—á–∏—Å–ª–∏ –¥–µ—Å–µ—Ç–∏—á–Ω–∞—Ç–∞ –æ—Ü–µ–Ω–∫–∞ —Å–ø–æ—Ä–µ–¥ –±—ä–ª–≥–∞—Ä—Å–∫–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞
            let grade = '';
            let gradeClass = '';
            
            if (percentage >= 92) {
                // 6.00 - 6.00 (92-100%)
                grade = '6.00';
                gradeClass = 'grade-excellent';
            } else if (percentage >= 76) {
                // 5.00 - 5.99 (76-91%)
                const gradeValue = 5 + ((percentage - 76) / 15) * 0.99;
                grade = gradeValue.toFixed(2);
                gradeClass = 'grade-very-good';
            } else if (percentage >= 60) {
                // 4.00 - 4.99 (60-75%)
                const gradeValue = 4 + ((percentage - 60) / 15) * 0.99;
                grade = gradeValue.toFixed(2);
                gradeClass = 'grade-good';
            } else if (percentage >= 40) {
                // 3.00 - 3.99 (40-59%)
                const gradeValue = 3 + ((percentage - 40) / 19) * 0.99;
                grade = gradeValue.toFixed(2);
                gradeClass = 'grade-satisfactory';
            } else if (percentage > 0) {
                // 2.00 - 2.99 (0-39%)
                const gradeValue = 2 + (percentage / 40) * 0.99;
                grade = gradeValue.toFixed(2);
                gradeClass = 'grade-poor';
            } else {
                grade = '';
                gradeClass = '';
            }

            gradeSpan.textContent = grade;
            gradeSpan.className = `grade-display ${gradeClass}`;
            percentageSpan.textContent = `${Math.round(percentage)}%`;
        }

        function fillBulkPoints() {
            const bulkPoints = document.getElementById('bulkPoints').value;
            if (!bulkPoints || bulkPoints < 0) {
                showAlert('–ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ –≤–∞–ª–∏–¥–µ–Ω –±—Ä–æ–π —Ç–æ—á–∫–∏!', 'error');
                return;
            }

            const test = tests.find(t => t.id === currentTestId);
            if (!test) return;

            const inputs = document.querySelectorAll('.result-input');
            inputs.forEach(input => {
                input.value = bulkPoints;
                const studentId = input.id.replace('points_', '');
                calculateGrade(parseInt(studentId), test.maxPoints);
            });

            showAlert(`–ü–æ–ø—ä–ª–Ω–µ–Ω–∏ —Å–∞ ${inputs.length} —Ä–µ–∑—É–ª—Ç–∞—Ç–∞ —Å ${bulkPoints} —Ç–æ—á–∫–∏!`, 'success');
        }

        function clearAllResults() {
            if (!confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—á–∏—Å—Ç–∏—Ç–µ –≤—Å–∏—á–∫–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏?')) {
                return;
            }

            const inputs = document.querySelectorAll('.result-input');
            inputs.forEach(input => {
                input.value = '';
                const studentId = input.id.replace('points_', '');
                const test = tests.find(t => t.id === currentTestId);
                if (test) {
                    calculateGrade(parseInt(studentId), test.maxPoints);
                }
            });

            showAlert('–í—Å–∏—á–∫–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ —Å–∞ –∏–∑—á–∏—Å—Ç–µ–Ω–∏!', 'success');
        }

        function saveResults() {
            if (!currentTestId) return;

            const test = tests.find(t => t.id === currentTestId);
            if (!test) return;

            const classStudents = students.filter(s => s.class === test.class);
            let savedCount = 0;
            let errors = [];

            // –ò–∑—Ç—Ä–∏–π —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ —Ç–æ–∑–∏ —Ç–µ—Å—Ç
            results = results.filter(r => r.testId !== currentTestId);

            classStudents.forEach(student => {
                const pointsInput = document.getElementById(`points_${student.id}`);
                if (!pointsInput) return;

                const points = parseFloat(pointsInput.value);
                
                // –ê–∫–æ –Ω—è–º–∞ –≤—ä–≤–µ–¥–µ–Ω–∏ —Ç–æ—á–∫–∏, –ø—Ä–µ—Å–∫–∞—á–∞–π
                if (isNaN(points) || points === '') return;

                if (points < 0 || points > test.maxPoints) {
                    errors.push(`${student.firstName} ${student.lastName}: –¢–æ—á–∫–∏—Ç–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ –º–µ–∂–¥—É 0 –∏ ${test.maxPoints}`);
                    return;
                }

                const percentage = (points / test.maxPoints) * 100;
                let grade = '';
                
                if (percentage >= 92) {
                    grade = '6.00';
                } else if (percentage >= 76) {
                    const gradeValue = 5 + ((percentage - 76) / 15) * 0.99;
                    grade = gradeValue.toFixed(2);
                } else if (percentage >= 60) {
                    const gradeValue = 4 + ((percentage - 60) / 15) * 0.99;
                    grade = gradeValue.toFixed(2);
                } else if (percentage >= 40) {
                    const gradeValue = 3 + ((percentage - 40) / 19) * 0.99;
                    grade = gradeValue.toFixed(2);
                } else if (percentage > 0) {
                    const gradeValue = 2 + (percentage / 40) * 0.99;
                    grade = gradeValue.toFixed(2);
                }

                const result = {
                    id: Date.now() + Math.random(),
                    studentId: student.id,
                    testId: test.id,
                    points: points,
                    grade: grade,
                    percentage: percentage,
                    dateAdded: new Date().toISOString()
                };

                results.push(result);
                savedCount++;
            });

            if (errors.length > 0) {
                showAlert(`–ì—Ä–µ—à–∫–∏ –ø—Ä–∏ –∑–∞–ø–∞–∑–≤–∞–Ω–µ—Ç–æ:\n${errors.join('\n')}`, 'error');
            }

            localStorage.setItem('results', JSON.stringify(results));
            
            if (savedCount > 0) {
                showAlert(`–£—Å–ø–µ—à–Ω–æ –∑–∞–ø–∞–∑–µ–Ω–∏ ${savedCount} —Ä–µ–∑—É–ª—Ç–∞—Ç–∞!`, 'success');
                closeResultsModal();
            } else {
                showAlert('–ù—è–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ!', 'error');
            }
        }

        function closeResultsModal() {
            document.getElementById('resultsModal').style.display = 'none';
            currentTestId = null;
            document.getElementById('bulkPoints').value = '';
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∑–∞ –∞–Ω–∞–ª–∏–∑ –Ω–∞ —Ç–µ—Å—Ç
        function showTestAnalytics(testId) {
            const test = tests.find(t => t.id === testId);
            if (!test) {
                showAlert('–¢–µ—Å—Ç—ä—Ç –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω!', 'error');
                return;
            }

            // –ù–∞–º–µ—Ä–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –∑–∞ —Ç–æ–∑–∏ —Ç–µ—Å—Ç
            const testResults = results.filter(r => r.testId === testId);
            const classStudents = students.filter(s => s.class === test.class);
            
            if (testResults.length === 0) {
                showAlert('–ù—è–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ —Ç–æ–∑–∏ —Ç–µ—Å—Ç!', 'error');
                return;
            }

            // –ó–∞–¥–∞–π –∑–∞–≥–ª–∞–≤–∏–µ—Ç–æ
            document.getElementById('testAnalyticsTitle').textContent = `–ê–Ω–∞–ª–∏–∑: ${test.name}`;

            // –ò–∑—á–∏—Å–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            const totalStudents = classStudents.length;
            const totalResults = testResults.length;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –æ—Ü–µ–Ω–∫–∏ (–ø–æ–¥–¥—ä—Ä–∂–∞ –¥–µ—Å–µ—Ç–∏—á–Ω–∏ –æ—Ü–µ–Ω–∫–∏)
            const gradeStats = {
                '6': testResults.filter(r => parseFloat(r.grade) >= 6.0).length,
                '5': testResults.filter(r => parseFloat(r.grade) >= 5.0 && parseFloat(r.grade) < 6.0).length,
                '4': testResults.filter(r => parseFloat(r.grade) >= 4.0 && parseFloat(r.grade) < 5.0).length,
                '3': testResults.filter(r => parseFloat(r.grade) >= 3.0 && parseFloat(r.grade) < 4.0).length,
                '2': testResults.filter(r => parseFloat(r.grade) >= 2.0 && parseFloat(r.grade) < 3.0).length
            };
            
            // –ò–∑—á–∏—Å–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–∏ –∑–∞ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ—Ç–æ
            const totalGrades = Object.values(gradeStats).reduce((sum, count) => sum + count, 0);
            const gradePercentages = {
                '6': totalGrades > 0 ? ((gradeStats['6'] / totalGrades) * 100).toFixed(1) : 0,
                '5': totalGrades > 0 ? ((gradeStats['5'] / totalGrades) * 100).toFixed(1) : 0,
                '4': totalGrades > 0 ? ((gradeStats['4'] / totalGrades) * 100).toFixed(1) : 0,
                '3': totalGrades > 0 ? ((gradeStats['3'] / totalGrades) * 100).toFixed(1) : 0,
                '2': totalGrades > 0 ? ((gradeStats['2'] / totalGrades) * 100).toFixed(1) : 0
            };
            
            // –°—Ä–µ–¥–Ω–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç
            const avgPercentage = totalResults > 0 ? 
                (testResults.reduce((sum, r) => sum + r.percentage, 0) / totalResults).toFixed(1) : 0;
            
            // –°—Ä–µ–¥–Ω–∞ –æ—Ü–µ–Ω–∫–∞ (–∏–∑—á–∏—Å–ª–µ–Ω–∞ –æ—Ç —Ä–µ–∞–ª–Ω–∏—Ç–µ –æ—Ü–µ–Ω–∫–∏)
            let avgGrade = '0.00';
            if (totalResults > 0) {
                const gradeValues = testResults.map(r => parseFloat(r.grade) || 0);
                const avgGradeValue = gradeValues.reduce((sum, g) => sum + g, 0) / totalResults;
                avgGrade = avgGradeValue.toFixed(2);
            }
            
            // –î–æ–±—Ä–∏ –æ—Ü–µ–Ω–∫–∏ (5-6)
            const goodGrades = gradeStats['5'] + gradeStats['6'];
            const goodGradesPercentage = totalGrades > 0 ? ((goodGrades / totalGrades) * 100).toFixed(1) : 0;

            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–π HTML –∑–∞ –∞–Ω–∞–ª–∏–∑–∞
            document.getElementById('testAnalyticsContent').innerHTML = `
                <div style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Ç–µ—Å—Ç–∞</h3>
                    <div style="background-color: white; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <strong>–¢–µ—Å—Ç:</strong> ${test.name}<br>
                        <strong>–ö–ª–∞—Å:</strong> ${test.class}<br>
                        <strong>–¢–∏–ø:</strong> ${test.type}<br>
                        <strong>–î–∞—Ç–∞:</strong> ${formatDate(test.date)}<br>
                        <strong>–ú–∞–∫—Å–∏–º–∞–ª–Ω–∏ —Ç–æ—á–∫–∏:</strong> ${test.maxPoints}
                    </div>
                </div>

                <div style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üìä –û–±—â–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background-color: white; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #2c3e50;">üë• –£—á–µ–Ω–∏—Ü–∏ –≤ –∫–ª–∞—Å–∞</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #27ae60; margin: 5px 0;">${totalStudents}</p>
                        </div>
                        <div style="background-color: white; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #2c3e50;">üìù –†–µ–∑—É–ª—Ç–∞—Ç–∏</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #3498db; margin: 5px 0;">${totalResults}</p>
                        </div>
                        <div style="background-color: white; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #2c3e50;">üìä –°—Ä–µ–¥–µ–Ω —É—Å–ø–µ—Ö</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #9b59b6; margin: 5px 0;">${avgGrade}</p>
                        </div>
                        <div style="background-color: white; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #2c3e50;">üéØ –î–æ–±—Ä–∏ –æ—Ü–µ–Ω–∫–∏ (5-6)</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #e67e22; margin: 5px 0;">${goodGradesPercentage}%</p>
                        </div>
                    </div>
                </div>
                
                <div style="background-color: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3>üéØ –†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ü–µ–Ω–∫–∏—Ç–µ</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px;">
                        <div style="background-color: #d4edda; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #155724;">–û—Ç–ª–∏—á–µ–Ω (6)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #155724; margin: 5px 0;">${gradeStats['6']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #155724; margin: 0;">${gradePercentages['6']}%</p>
                        </div>
                        <div style="background-color: #d1ecf1; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #0c5460;">–ú–Ω–æ–≥–æ –¥–æ–±—ä—Ä (5)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #0c5460; margin: 5px 0;">${gradeStats['5']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #0c5460; margin: 0;">${gradePercentages['5']}%</p>
                        </div>
                        <div style="background-color: #fff3cd; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #856404;">–î–æ–±—ä—Ä (4)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #856404; margin: 5px 0;">${gradeStats['4']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #856404; margin: 0;">${gradePercentages['4']}%</p>
                        </div>
                        <div style="background-color: #f8d7da; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #721c24;">–°—Ä–µ–¥–µ–Ω (3)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #721c24; margin: 5px 0;">${gradeStats['3']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #721c24; margin: 0;">${gradePercentages['3']}%</p>
                        </div>
                        <div style="background-color: #f5c6cb; padding: 15px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 style="margin: 0; color: #721c24;">–°–ª–∞–± (2)</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #721c24; margin: 5px 0;">${gradeStats['2']} –±—Ä.</p>
                            <p style="font-size: 14px; color: #721c24; margin: 0;">${gradePercentages['2']}%</p>
                        </div>
                    </div>
                </div>
            `;

            // –ü–æ–∫–∞–∂–∏ –º–æ–¥–∞–ª–Ω–æ—Ç–æ –ø—Ä–æ–∑–æ—Ä—á–µ
            document.getElementById('testAnalyticsModal').style.display = 'block';
        }

        function closeTestAnalyticsModal() {
            document.getElementById('testAnalyticsModal').style.display = 'none';
        }

        // –ó–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ –º–æ–¥–∞–ª–Ω–æ—Ç–æ –ø—Ä–æ–∑–æ—Ä—á–µ –ø—Ä–∏ –∫–ª–∏–∫ –∏–∑–≤—ä–Ω –Ω–µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('resultsModal');
            const analyticsModal = document.getElementById('testAnalyticsModal');
            const studentsModal = document.getElementById('studentsModal');
            if (event.target === modal) {
                closeResultsModal();
            }
            if (event.target === analyticsModal) {
                closeTestAnalyticsModal();
            }
            if (event.target === studentsModal) {
                closeStudentsModal();
            }
        }
    </script>
</body>
</html>